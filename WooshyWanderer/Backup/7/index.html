<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimum-scale=1, width=device-width, height=device-height">


</head>
<body>

<canvas id="game" width="240" height="135"></canvas>
<script>

let img = new Image();
img.src = 'Image/Biplane.png';
let angle = 45;
let radians = angle * Math.PI / 180;


img.onload = function() {
  init();
};

let canvas = document.querySelector('canvas');
let ctx = canvas.getContext('2d');
// Keys states (false: key is released / true: key is pressed)
up = right = down = left = false;
let speed = 0;
// Keydown listener
onkeydown = (e) => {
speed = 1;
  // Up (up / W / Z)
  if(e.keyCode == 38 || e.keyCode == 90 || e.keyCode == 87){
    up = true;
  }
  
  // Right (right / D)
  if(e.keyCode == 39 || e.keyCode == 68){
	
    right = true;
  }
  
  // Down (down / S)
  if(e.keyCode == 40 || e.keyCode == 83){
    down = true;
  }
  
  // Left (left / A / Q)
  if(e.keyCode == 37 || e.keyCode == 65 ||e.keyCode == 81){
    left = true;
  }
 
}

// Keyup listener
onkeyup = (e) => {

  // Up
  if(e.keyCode == 38 || e.keyCode == 90 || e.keyCode == 87){
    up = false;
  }
  
  // Right
  else if(e.keyCode == 39 || e.keyCode == 68){
    right = false;
  }
  
  // Down
  else if(e.keyCode == 40 || e.keyCode == 83){
    down = false;
  }
  
  // Left
  else if(e.keyCode == 37 || e.keyCode == 65 || e.keyCode == 81){
    left = false;
  }
  
}

function movePlayer()
{
	if(up==false&&down==false&&right==false&&left==false)
  {
	  speed = 0;
  }
	if(down == true && right == true)
	{
		angle = 315;
	}
	else if(down == true && left == true)
	{
		angle = 225;
	}
	else if(down == true)
	{
		angle = 270;
	}
	else if(up == true && right == true)
	{
		angle = 45;
	}
	else if(up == true && left == true)
	{
		angle = 135;
	}
	else if(up == true)
	{
		angle = 90;
	}
	
	
	else if(right == true)
	{
		angle = 0;

	}
	else if(left == true)
	{
		angle = 180;

	}
	radians = (360 - angle) * Math.PI / 180;
  
  if(playerX <= canvas.width-15)
  {
    playerX += Math.cos(radians) * speed;
  }
  else
  {
    playerX = canvas.width-15;
  }
  if(playerX <= 0)
  {
    playerX = 0;
  }
 
  if(playerY <= canvas.height-15)
  {
	  playerY += Math.sin(radians) * speed;
  }
  else
  {
    playerY = canvas.height-15;
  }
  if(playerY <= 0)
  {
	  playerY = 0;
  }
	
}


const scale = 1;
const width = 15;
const height = 15;
const scaledWidth = scale * width;
const scaledHeight = scale * height;
let playerY = canvas.height-height-5;
let playerX = canvas.width/2-8;


function drawFrame(frameX, canvasX, canvasY) {
  ctx.drawImage(img,
                frameX * width, 0, width, height,
                canvasX, canvasY, scaledWidth, scaledHeight);

}

let currentLoopIndex = 0;
let frameCount = 0;

function step() {
	movePlayer();
  frameCount++;
  if (frameCount < 2) {
    window.requestAnimationFrame(step);
    return;
  }
  frameCount = 0;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
	let colors = "#1D1C1F";
  ctx.fillStyle = colors;
  ctx.fillRect(0,0,canvas.width,canvas.height);
	

let animationFrames = [0,1,2,3,4,3,2,1];
  drawFrame(animationFrames[currentLoopIndex], Math.round(playerX),  Math.round(playerY));
  currentLoopIndex++;
  if (currentLoopIndex >= animationFrames.length) 
  {
    currentLoopIndex = 0;
  }
  window.requestAnimationFrame(step);
}

function init() {
  window.requestAnimationFrame(step);
}


// newly spawned objects start at Y=25
var spawnLineY = 0;

// spawn a new object every 1500ms
var spawnRate = 500;

// when was the last object spawned
var lastSpawn = -1;

// this array holds all spawned object
var objects = [];

// save the starting time (used to calc elapsed time)
var startTime = Date.now();

var img1 = new Image();
img1.src = "Image/bomb.png";

var img2 = new Image();
img2.src = "Image/bomb.png";

var img3 = new Image();
img3.src = "Image/bomb.png";

// Our images array
var images = [img1, img2, img3];

// start animating
window.onload=function(){
animate();
}

function spawnRandomObject() {

    // create the new object
    var object1 = {
        // set this objects type

		    spawnRateOfDescent: 2.50,
        // set x randomly but at least 15px off the canvas edges
        x: Math.random() * (canvas.width - 30) + 15,
        // set y to start on the line where objects are spawned
        y: spawnLineY,
        // give random image
        image: images[0]
    }

	// create the new object
    var object2 = {
        // set this objects type
       

		spawnRateOfDescent: 0.50,
        // set x randomly but at least 15px off the canvas edges
        x: Math.random() * (canvas.width - 30) + 15,
        // set y to start on the line where objects are spawned
        y: spawnLineY,
        // give random image
        image: images[1]
    }
	// create the new object
    var object3 = {
        // set this objects type
        

		spawnRateOfDescent: 1.00,
        // set x randomly but at least 15px off the canvas edges
        x: Math.random() * (canvas.width - 30) + 15,
        // set y to start on the line where objects are spawned
        y: spawnLineY,
        // give random image
        image: images[2]
    }
	var objectType = [object1, object2, object3];
    // add the new object to the objects[] array
    objects.push(objectType[Math.floor(Math.random() * objectType.length)]);
}



function animate() {

    // get the elapsed time
    var time = Date.now();

    // see if its time to spawn a new object
    if (time > (lastSpawn + spawnRate)) {
        lastSpawn = time;
        spawnRandomObject();
    }

    // request another animation frame
    requestAnimationFrame(animate);

    
    // move each object down the canvas
    for (var i = 0; i < objects.length; i++) {
        var object = objects[i];
		if(object.y < canvas.height)
		{
			object.y += object.spawnRateOfDescent;
		}
        else
		{
			objects.splice(i, 1);
		}
        ctx.drawImage(object.image, Math.round(object.x), Math.round(object.y), 15, 15);
    }

}

</script>
</body>
</html>
