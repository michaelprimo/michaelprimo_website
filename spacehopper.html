<!doctype html>
<head>
	<title>Title ~ js1024</title>
	<meta name="author" content="Author"></meta>
	<meta name="description" content="Short description"></meta>
	<meta name="title" content="Title"></meta>
	<meta charset=utf-8>
</head>
<body id=b>
<canvas id=a></canvas>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
#a { position: relative; display: block;}
.play { position: fixed; top: 50%; left: 50%; transform: translateX(-50%)translateY(-50%); font-size: 30px; font-family: arial, sans-serif; background: #f3f4f5; padding: 15px; border: 2px solid #ddd; border-radius: 5px; }
</style>

<script>

// Entry configuration
// ===================

var title = "Title"; // this will be assigned automatically

// Shim setup and polyfills (do not edit)
// ======================================

// canvas automatically adjusted !
a.width = innerWidth;
a.height = innerHeight;

c = a.getContext("2d"); // no more $type conditional

d = document;
window.AudioContext = window.AudioContext || window.webkitAudioContext;
window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
a.requestPointerLock = a.requestPointerLock || a.mozRequestPointerLock || a.webkitRequestPointerLock;
navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
if (typeof OscillatorNode !== 'undefined' && OscillatorNode.prototype) {
  OscillatorNode.prototype.start = OscillatorNode.prototype.start || OscillatorNode.prototype.noteOn;
  OscillatorNode.prototype.stop = OscillatorNode.prototype.stop || OscillatorNode.prototype.noteOff;
}

// Add a start button if sound is present in the code
onload = () => {
  var entry_code = entry.innerText;
  var has_sound = false;
  if(entry_code.includes('eval')){
    try {
      eval(entry_code.replace(/eval\(/g, 'throw(').replace(/eval\`/g, 'throw`'));
    }
    catch(e){
      entry_code = e;
    }
  }
  if(entry_code.includes("AudioContext")||entry_code.includes("Oscillator")||entry_code.includes("speak")||entry_code.includes("play")||entry_code.includes("autoplay")){
    b.insertAdjacentHTML("beforeEnd", "<button class='play' onclick='console.log(entry.innerText);eval(entry.innerText);this.remove()'>PLAY</button>");
  }
  else {
    eval(entry.innerText);
  }
};
console.log(
  a, // canvas
  b, // body
  c, // 2D canvas context
  d  // document
);

</script>

<script type=text id=entry>
// Your entry goes here ðŸ‘‡
// =======================
//SPACE HOPPER: Made by Michael Primo for the JS1024 competition.

// Get ready for the journey! We are going in a galaxy far, far away!

//Store the height of the Canvas
h=a.height;
//Store the width of the Canvas
w=a.width;
//This mimic the vh on text
v = h/99;
//This is half width. Useful for position the main character, the text and the collision
x = w/2;
//y and k are the main y positions of the characters
y=k=h/9*4;
//Main speed based on how big the width of the screen is
s = w/99;
//A coefficent for determining how speed increase on every level of the asteroids. Also, it sets the speed of the stars
f = s/4;
//main variables, most of them "booleans".
z=p=d=g=j=u=e=l=1;
//arrays for setting the x and y positions of the stars
r=[],t=[];
//set Math.random, so I can recycling it;
n=Math.random;
//set the type of the sound we can play
q="sine"

//loop for populate the star position based on the screen coordinates..
  for(i = 0; i<99; i++)
  {
    r[i] = n() * w
    t[i] = n() * h
  }
  
  //main loop of the game
  setInterval(function()
  {
    //if the game is on, then start all the game loop
    if(g==1)
    {
      //check if the localstorage is on
    localStorage.e>1?e=localStorage.e:0
    //if you surpassed your record, then save it here;
    p>e?localStorage.e=p:0;

    //refresh the canvas
    a.width=w;

    //color and draw the screen.
    c.fillStyle = "#104";
    c.fillRect(0, 0, w, h);
      
    //draw 99 stars and make them move. The other one star of 100 is on a $99.99 DLC of Space Hopper, sorry.
    for(i = 0; i<99; i++)
    {
      c.font = '1vh serif'
      //this is used for move the stars
      r[i]+=f/5*l
      //this for resetting the position of the stars if they go offscreen
      if(r[i]>=w)r[i]=0
      //draw the star. Did you see the sky? It seems so true!
      c.fillText("ðŸŒŸ", r[i], t[i])
    }
    //drawing the main character, the great and almighty Space Hopper itself!
    c.font = '6vh serif';
    c.textAlign="center";
    c.fillText("ðŸ‘¾", x, y);

    //make the font white and not purple as the screen
    c.fillStyle = "#fff";
    //used some spare bytes to make this text more clear:
    c.fillText("Level: "+l, x, 50);
    c.fillText(" Score: "+p+"/"+e, x, 100);
    
    // draw one evil and bad asteroid! (it's not the emoji full moon at all)
    //this is the size
    c.font = '9vh serif';
    //Draw the asteroid!
    c.fillText("ðŸŒ•", j, k);
    //move the asteroid thanks with setting the variable through adding it the main speed
      j += s;
      //if the asteroid fly away off screen, you run this piece of code
      if(j >= w+v*9 || j <= -v*9)
      {
        //Congrats! You won extra points!
        p+=9*l;
        //And a level too!
        l++;
        //Set the triangle sound
        q="triangle";
        //Play it
        u=1;
        //set the direction randomly
        d = Math.floor(n() * 4);
        //I could do Math.abs here and used the same bytes, but I golfed it anyway because I have weird thoughts someday
        s<0?s=-s+f:s+=f
        //set the height of the asteroid down if d is 0 or 1
        d==0||d==1?k = h/9*6:0
        //else setting it on up
        d==2||d==3?k = h/9*4:0
        //set the y
        d==0||d==2?j = -v*6:0
        //revert speed
        if(d==1||d==3)
        {
          j = w+v*4
          s = -s
        }
      }
      //this happens if the asteroid crashed on the Space Hopper. If you were more careful he would train more and I would had more bits to hack around :( 
      if(j - x <= v*7 && j - x >= -v*7 && y==k)
      {
        //set the sound as sawtooth
        q="sawtooth"
        //play the sound
        u=1
        //draw the crashing emoji on the Space Hopper. It's so cruel, why I made this, I don't want to look anymore
        c.fillText("ðŸ’¥", x, y)
        //Put to 0 the "gameover boolean", so the screen will freeze. 
        g=0
      }
      //if the music boolean is on then play some sick drops...maybe. Only sound effects for now.
      if(u==1)
      {
        //set the AudioContext. Don't know if this could be golfed in some way.
        m = new AudioContext
        //set the oscillator for making basic sounds
        o = m.createOscillator()
        //set the type of sound based on q
        o.type=q
        //preparing to play...
        o.connect(m.destination)
        //...play the sound!
        o.start()
        //...but then stop it, otherwise this can be endless and the game is unplayable because of the loud sounds and you don't want that. At least, not me. So this piece is REALLY IMPORTANT.
        o.stop(0.1)
        //reset the variable, otherwise we could have an endless sound anyway.
        u=0
      }
    }
    //main loop ended, but this will be recalled every 33 microseconds, so we have near 30 FPS on this game. I know I could made 9 microseconds, but then I had to put more bits on some code for rebalancing it and I decided it was not worthing it.
  }, 33);
  

//If you click to the canvas, you can run this code.
a.addEventListener('click', function() {
  //if the game is on...
  if(g==1)
  {
    //...you click and hop and you get some points based on the levels you have! GG 
    p+=l;
    //Draw some sparkles when hopping. The game will refresh the screen so I saved bytes this way.
    c.fillText("âœ¨", x, y);
    //set the position of the Space Hopper if he will go up or down after the click.
    z==1?y = h/9*6:y=h/9*4;
    //revert the "boolean"
    z=-z;
    //set the sound as "sine" and play it
    q="sine";u=1;
  }
});

//THE END. THANKS FOR WATCHING! WE WILL SEE YOU IN THE NEXT EPISODE!
//Github: https://github.com/michaelprimo
// =======================
</script>
</body>
